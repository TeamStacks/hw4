<!DOCTYPE html>
<html lang="en">

<head>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="description" content="bullion management site, rare coins, gold, silver, platinum">
  <meta name="author" content="CSE134B Team Stacks">
  <!-- Latest compiled and minified CSS -->
  <link rel="stylesheet" href="./css/bootstrap.min.css">
  <link rel="stylesheet" type="text/css" href="./style/style.css">
  <meta name=viewport content="width=device-width, initial-scale=.8, minimum-scale = .8, user-scalable=yes">
  <link rel="icon" href="favicon.ico" type="image/x-icon" />
  <link rel="shortcut icon" href="favicon.ico" type="image/x-icon" />
  <link href="./css/c3.min.css" rel="stylesheet" type="text/css">
  <link href="./css/chart.css" rel="stylesheet" type="text/css">
  <!-- BEGIN TRACKJS -->
  <script type="text/javascript">window._trackJs = { token: 'e91fe3cc79bb4f6583216124840df056' };</script>
  <script type="text/javascript" src="./js/tracker.js" crossorigin="anonymous"></script>
  <!-- END TRACKJS -->
  <script src="./js/jquery-1.11.2.min.js"></script>
  <script type="text/javascript" src="./js/parse-1.4.2.min.js"></script>
  <script type="text/javascript" src="./js/init.js"></script>
  <script src="./js/profile.js"></script>
  <script src="./js/Chart.js"></script>
  <script src="./js/main.js"></script>
  <script src="./js/query.js"></script>
  <script src="./js/quandl.js"></script>
  <script src="./js/d3.min.js"></script>
  <script src="./js/c3.min.js"></script>
  <!-- Latest compiled and minified JavaScript -->
  <script src="./js/bootstrap.min.js"></script>
  <title>My Gold - CoinFlip</title>
</head>

<body>
  <script type="text/javascript">
    loadTopNav();
  </script>
  <script type="text/javascript">
    var metalFrom = parseURLParams()['q'];
    var defaultUrl = window.location.href.indexOf('?q=')
    var metalChose;
    if (metalFrom == "Gold" || defaultUrl == -1 ){
      metalChose = 1;
    }
    else if (metalFrom == "Silver"){
      metalChose = 2;
    }
    else if (metalFrom == "Platinum"){
      metalChose = 3;
    }

    loadSideNav(metalChose);
  </script>
  <section class="main-section">
    <section class="coin_wrapper">
      <div class="mobile-nav">
        <a href="wire2.html">
          <svg class="icon icon-keyboard-arrow-left">
            <symbol id="icon-keyboard-arrow-left" viewBox="0 0 1024 1024">
              <title>keyboard-arrow-left</title>
              <path class="path1" d="M657.707 696.96l-195.627-195.627 195.627-195.627-60.373-60.373-256 256 256 256z"></path>
            </symbol>
            <use xlink:href="#icon-keyboard-arrow-left"></use>
          </svg>
        </a>
        MY GOLD
        <a href="wire5.html">
          <svg class="icon icon-add">
            <symbol id="icon-add" viewBox="0 0 1024 1024">
              <title>add</title>
              <path class="path1" d="M810.667 554.667h-256v256h-85.333v-256h-256v-85.333h256v-256h85.333v256h256v85.333z"></path>
            </symbol>
            <use xlink:href="#icon-add"></use>
          </svg>
        </a>
      </div>
      <section class="overview-panel">
        <section class="total-value">
          <div class="total-dollars">$18,234.10</div>
          <table class="current_gold">
            <tr>
              <td>Daily</td>
              <td id="daily-change">+3.5%</td>
            </tr>
            <tr>
              <td>Overall</td>
              <td id="overall-change">+1.2%</td>
            </tr>
          </table>
          <div class="total-label" id="my_gold_value">My Gold Value</div>
        </section>
        <section class="mobile-toggle">
          <div class="mobile-toggle-button mtb-1 mobile-toggle-selected">
            <svg class="icon icon-menu">
              <symbol id="icon-menu" viewBox="0 0 1024 1024">
                <title>menu</title>
                <path class="path1" d="M128 768h768v-85.333h-768v85.333zM128 554.667h768v-85.333h-768v85.333zM128 256v85.333h768v-85.333h-768z"></path>
              </symbol>
              <use xlink:href="#icon-menu"></use>
            </svg>
          </div>
          <div class="mobile-toggle-button mtb-2">
            <svg class="icon icon-graph">
              <symbol id="icon-graph" viewBox="0 -200 1424 1424">
                <title>graph</title>
                <path class="path1" d="M704 256h-192v640h192v-640zM960 448h-192v448h192v-448zM64 960v-128h64v-64h-64v-128h64v-64h-64v-128h64v-64h-64v-128h64v-64h-64v-128h64v-64h-128v1024h1024v-64h-960zM448 576h-192v320h192v-320z"></path>
              </symbol>
              <use xlink:href="#icon-graph"></use>
            </svg>
          </div>
        </section>
        <section class="market-list">
          <section class="market-item-header" id="current-spot">
            Current Spot
          </section>
          <section class="market-item-stats">
            <table>
              <tr>
                <td id="bid">1206.10</td>
                <td id="ask">1207.10</td>
                <td id="change" class="pos-change">+23.40</td>
              </tr>
              <tr>
                <td>Bid</td>
                <td>Ask</td>
                <td>Change</td>
              </tr>
            </table>
          </section>
        </section>
      </section>
      <section class="graph-panel">
        <section class="chart-wrap">
          <div id="total-chart"></div>
        </section>
      </section>
      <section class="my_stack">
        <table id="inventory">
          <caption>
            <section class="label-and-search">
              <h3 id = "displayMetal">My Gold</h3>
              <div class="stack_ctrl">
                <input id="search" type="search" placeholder="Search" />
                <a href="wire5.html">
                  <svg enable-background="new 0 0 24 24" height="24px" id="Layer_1" version="1.1" viewBox="0 0 24 24" width="24px" xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
                    <path clip-rule="evenodd" d="M22.5,14H14v8.5c0,0.276-0.224,0.5-0.5,0.5h-4C9.224,23,9,22.776,9,22.5V14H0.5  C0.224,14,0,13.776,0,13.5v-4C0,9.224,0.224,9,0.5,9H9V0.5C9,0.224,9.224,0,9.5,0h4C13.776,0,14,0.224,14,0.5V9h8.5  C22.776,9,23,9.224,23,9.5v4C23,13.776,22.776,14,22.5,14z" fill-rule="evenodd" fill="white" />
                  </svg>
                </a>
              </div>
            </section>
          </caption>
          <thead>
            <tr>
              <th class="stack_img_col">Image</th>
              <th>Item</th>
              <th>Qty.</th>
              <th class="weight_compr"><span>Weight/unit (g)</span></th>
              <th class="percent_compr"><span id = "metalTypePercent">% Au</span></th>
              <th>Value</th>
            </tr>
          </thead>
          <tbody>
          </tbody>
        </table>
      </section>
    </section>
  </section>
    <div class="modal fade" id="profile" tabindex="-1" role="dialog" aria-labelledby="ProfileModal" aria-hidden="true">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <button type="button" class="close2 btn btn-default" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
            <h4 class="modal-title" id="ProfileModal">MY PROFILE</h4>
          </div>
          <form>
            <div class="modal-body">
                <div class="form-group">
                    <label>USERNAME</label><br>
                    <p id="user" class="no-dec"></p>
                </div>
                <div class="form-group">
                    <label for="pass">NEW PASSWORD</label>
                    <input type="password" class="form-control" id="pass" placeholder="Password">
                </div>
                <label>
                  <input type="checkbox" id="checkbox"> Use Light Theme
                </label><br>

                <button type="button" class="btn btn-primary" onclick="update()">Update Profile</button>
            </div>
            <div class="modal-footer">
                 <button id ="fblink" type="button" class="btn btn-primary" onclick="linkfb()">Link Facebook</button> <button type="button" class="btn btn-danger" onclick="logOut()">Log Out</button>
            </div>
          </form>
        </div>
      </div>
    </div>

  <script>
    verify();
    populateTable(metalFrom);

  
    function inspectCoin(row){
        //alert("Taking a closer look at coin with ID: "+ row.id);
        if (defaultUrl == -1){
           window.document.location = "wire4.html?id=" + row.id + "&q=Gold";
        }
        else{
        window.document.location = "wire4.html?id=" + row.id + "&q=" + metalFrom;}
    }

    $("#search").keyup(function () {
        var searchQuery = $(this).val();

        var rows = $("#inventory tbody tr");
        rows.addClass("hidden");
        rows.children(":contains('" + searchQuery + "')").parent().removeClass("hidden");
    });
  </script>
    <script>
      if (metalFrom == "Gold" || defaultUrl == -1 ){
        document.getElementById("my_gold_value").innerHTML = "My Gold Value";
        document.getElementById("displayMetal").innerHTML = "My Gold";
        $( ".legend-item1" ).append('<div class="legend-item-color" id="legend-1"></div>');
        $( ".legend-item1" ).append("Gold Total");
        $( ".legend-item2" ).append('<div class="legend-item-color" id="legend-4"></div>');
        $( ".legend-item2" ).append("1oz Gold");
        document.getElementById("metalTypePercent").innerHTML = "% Au";     
      }
      else if (metalFrom == "Silver"){
        document.getElementById("my_gold_value").innerHTML = "My Silver Value";
        document.getElementById("displayMetal").innerHTML  = "My Silver";
        $( ".legend-item1" ).append('<div class="legend-item-color" id="legend-3"></div>');
        $( ".legend-item1" ).append("Silver Total");
        $( ".legend-item2" ).append('<div class="legend-item-color" id="legend-6"></div>');
        $( ".legend-item2" ).append("1oz Silver");
        document.getElementById("metalTypePercent").innerHTML = "% Ag";   
      }
      else if (metalFrom == "Platinum"){
        document.getElementById("my_gold_value").innerHTML = "My Platinum Value";
        document.getElementById("displayMetal").innerHTML = "My Platinum";
        $( ".legend-item1" ).append('<div class="legend-item-color" id="legend-2"></div>');
        $( ".legend-item1" ).append("Platinum Total");
        $( ".legend-item2" ).append('<div class="legend-item-color" id="legend-5"></div>');
        $( ".legend-item2" ).append("1oz Platinum");
        document.getElementById("metalTypePercent").innerHTML = "% Pt"; 
      }
  </script>
  <script type="text/javascript">
    verify();
    loadFooter();

    var metalFrom = parseURLParams()['q'];

    queryOwnedCoins(metalFrom, function(results) {
        var totalValue = 0;

        for (var i = 0; i < results.length; i++) {
            totalValue += parseFloat(results[i].get("value"));
            console.log(results[i].get("purchaseDate"));
        }

        var dailyChange = 0;
        var overallChange = 0;

        if (results.length >= 2) {
            var latestValue = parseFloat(results[results.length - 1].get("value"));
            var secondLatestValue = parseFloat(results[results.length - 2].get("value"));

            dailyChange = latestValue - secondLatestValue;
            overallChange = latestValue - (totalValue - latestValue) / results.length;
        } else if (results.length >= 1) {
            dailyChange = 1;
            overallChange = 1;
        }

        dailyChange *= 100;
        overallChange *= 100;

        var totalValueStr = '$' + totalValue.toFixed(2);
        var dailyChangeStr = dailyChange > 0 ? '+' + dailyChange.toFixed(0) + '%' : dailyChange.toFixed(0) + '%';
        var overallChangeStr = overallChange > 0 ? '+' + overallChange.toFixed(0) + '%' : overallChange.toFixed(0) + '%';

        $(".total-value > .total-dollars").text(totalValueStr);
        $("#daily-change").text(dailyChangeStr);
        $("#overall-change").text(overallChangeStr);

        if (dailyChange >= 0) {
            $("#daily-change").removeClass('neg-change').addClass('pos-change');
        } else {
            $("#daily-change").removeClass('pos-change').addClass('neg-change');
        }

        if (overallChange >= 0) {
            $("#overall-change").removeClass('neg-change').addClass('pos-change');
        } else {
            $("#overall-change").removeClass('pos-change').addClass('neg-change');
        }
    });
  </script>
</body>

</html>