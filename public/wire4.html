<!DOCTYPE html>
<html lang="en">

<head>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8">
    <meta name="description" content="bullion management site, rare coins, gold, silver, platinum">
    <meta name="author" content="CSE134B Dream Team">
    <!-- Latest compiled and minified CSS -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/css/bootstrap.min.css">
    <link rel="stylesheet" type="text/css" href="./style/style.css">
    <meta name=viewport content="width=device-width, initial-scale=.8, minimum-scale = .8, user-scalable=yes">
    <link rel="icon" href="favicon.ico" type="image/x-icon" />
    <link rel="shortcut icon" href="favicon.ico" type="image/x-icon" />
    <script src="./js/jquery-1.11.2.min.js"></script>
    <script src="./js/velocity.min.js"></script>
    <script src="./js/main.js"></script>
    <script src="./js/account.js"></script>
    <script type="text/javascript" src="./js/parse-1.4.2.min.js"></script>
    <script type="text/javascript" src="./js/parsefb.js"></script>
    <!-- Latest compiled and minified JavaScript -->
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/js/bootstrap.min.js"></script>
    <title>Gold Item - CoinFlip</title>
</head>

<body>
    <script type="text/javascript">
    loadTopNav();
    </script>
    <script type="text/javascript">
    loadSideNav(1);
    </script>
    <section class="main-section">
        <section class="coin_wrapper">
            <div class="mobile-nav">
                <a href="wire3.html">
                    <svg class="icon icon-keyboard-arrow-left">
                        <symbol id="icon-keyboard-arrow-left" viewBox="0 0 1024 1024">
                            <title>keyboard-arrow-left</title>
                            <path class="path1" d="M657.707 696.96l-195.627-195.627 195.627-195.627-60.373-60.373-256 256 256 256z"></path>
                        </symbol>
                        <use xlink:href="#icon-keyboard-arrow-left"></use>
                    </svg>
                </a>
                ITEM DETAIL
            </div>
            <div class="coin_main">
                <a href="wire3.html">
                    <div class="breadcrumb">
                        <svg class="icon icon-play-arrow-rev">
                            <symbol id="icon-play-arrow" viewBox="0 0 1024 1024">
                                <title>play-arrow</title>
                                <path class="path1" d="M682.667 213.333v597.333l-469.333-298.667z"></path>
                            </symbol>
                            <use xlink:href="#icon-play-arrow"></use>
                        </svg>
                        Item Detail
                    </div>
                </a>
                <section class="coin_image">
                    <div class="img_box">
                            <div class="img_container">
                                <div class="img_circle">
                                </div>
                            </div>
                    </div> 
                </section>
                <section class="coin_detail">
                    <table>
                        <tr>
                            <td>Metal</td>
                            <td id="metal">Loading</td>
                        </tr>
                        <tr>
                            <td>Type</td>
                            <td id="type">Loading</td>
                        </tr>
                        <tr>
                            <td>Purchase Date</td>
                            <td id="purchase_date">Loading</td>
                        </tr>
                        <tr>
                            <td>Qty.</td>
                            <td id="quantity">Loading</td>
                        </tr>
                        <tr>
                            <td>Premium</td>
                            <td id="premium">Loading</td>
                        </tr>
                        <tr>
                            <td>Unit Price</td>
                            <td id="unit_price">Loading</td>
                        </tr>
                        <tr>
                            <td>Gold %</td>
                            <td id="metal_percentage">Loading</td>
                        </tr>
                        <tr>
                            <td>Weight/unit (g)</td>
                            <td id="weight_per_unit">Loading</td>
                        </tr>
                        <tr>
                            <td>Gold g/u</td>
                            <td id="grams_per_unit">Loading</td>
                        </tr>
                        <tr>
                            <td>Gold ozt/u</td>
                            <td id="ozt_per_unit">Loading</td>
                        </tr>
                        <tr>
                            <td>Total au (ozt)</td>
                            <td>0.0400</td>
                        </tr>
                        <tr>
                            <td><strong>TOTAL</strong></td>
                            <td><strong id="value">Loading</strong></td>
                        </tr>
                    </table>
                    <span id="delete" onclick="deleteCoin(parseURLParams()['id'])">Delete</span>
                </section>
            </div>
        </section>
    </section>

    <div class="modal fade" id="profile" tabindex="-1" role="dialog" aria-labelledby="ProfileModal" aria-hidden="true">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <button type="button" class="close2 btn btn-default" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
            <h4 class="modal-title" id="ProfileModal">MY PROFILE</h4>
          </div>
          <form>
            <div class="modal-body">
                <div class="form-group">
                    <label>USERNAME</label><br>
                    <p id="user" class="no-dec"></p>
                </div>
                <div class="form-group">
                    <label for="pass">NEW PASSWORD</label>
                    <input type="password" class="form-control" id="pass" placeholder="Password">
                </div>
                <button type="button" class="btn btn-primary" onclick="update()">Update Profile</button> <button type="button" id ="fblink" class="btn btn-primary" onclick="linkfb()">Link Facebook</button>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-danger" onclick="logOut()">Log Out</button>
            </div>
          </form>
        </div>
      </div>
    </div>
    
    <script type="text/javascript">
        verify();
        loadFooter();
        loadCoin(parseURLParams()['id']);

        function parseURLParams() {
            var params = {};
            window.location.search.replace(/[?&]+([^=&]+)=([^&]*)/gi, function(ms, key,value) {
                params[key] = value;
            });
            return params;
        }

        function loadCoin(coinID) {
        
            // grab info from Coin db
            var Coin = Parse.Object.extend("Coin");
            var coinType = new Parse.Query(Coin);

            // Make sure the coin actually exists...
            coinType.get(coinID, {
                success: function(coin) {
                    $("#type").text(coin.get("Type"));
                    $("#grams_per_unit").text(coin.get("gramsPerUnit"));
                    $("#metal").text(coin.get("metal"));
                    $("#metal_percentage").text(coin.get("metalPercentage"));
                    $("#ozt_per_unit").text(coin.get("oztPerUnit"));
                    $("#premium").text(coin.get("premium"));
                    $("#unit_price").text(coin.get("unitPrice"));
                    $("#weight_per_unit").text(coin.get("weightPerUnit"));
                    console.log(coin.get("imageURL"));
                    if (coin.get("imageURL") != null) {
                        $(".img_container")[0].innerHTML ='<img id="coinimg" src="'+coin.get("imageURL")+'">';
                    }
                
                    // grab info from Inventory db
                    var Inventory = Parse.Object.extend("Inventory");
                    var userInventory = new Parse.Query(Inventory);

                    userInventory.equalTo("type", coin);
                    userInventory.find({
                      success: function(results) {
                        console.log("Successfully retrieved " + results.length + " scores.");

                        $("#purchase_date").text(results[0].get("purchaseDate").toDateString());
                        $("#quantity").text(results[0].get("quantity"));
                        $("#value").text(results[0].get("value"));
                        
                      },
                      error: function(error) {
                        alert("Error: " + error.code + " " + error.message);
                      }
                    });
         
                },
                // The cake's a lie...
                error: function(inventory, error) {
                    alert("Unable to retrieve coin information! " + error.message);
                    //window.history.back();
                }
            });
        }

        function deleteCoin(coinID) {
            // grab info from Coin db
            var Coin = Parse.Object.extend("Coin");
            var coinType = new Parse.Query(Coin);

            // Make sure the coin actually exists...
            coinType.get(coinID, {
                success: function(coin) {

                    // grab info from Inventory db
                    var Inventory = Parse.Object.extend("Inventory");
                    var userInventory = new Parse.Query(Inventory);

                    userInventory.equalTo("type", coin);
                    userInventory.find({
                      success: function(results) {
                        results[0].destroy();
                        
                      },
                      error: function(error) {
                        alert("Error: " + error.code + " " + error.message);
                      }
                    });
         

                    coin.destroy({
                      success: function(myObject) {
                            alert("You have deleted this item.");
                          window.document.location = "wire3.html";
                      },
                      error: function(myObject, error) {
                        // The delete failed.
                        // error is a Parse.Error with an error code and message.
                      }
                    });
                },
                error: function () {

                }
            });
            
        }
    </script>
</body>

</html>
